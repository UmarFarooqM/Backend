<!DOCTYPE html>
<html>
  <head>
    <title>Simple Meal Pagination</title>
    <style>
      body {
        font-family: Arial;
      }
      .meal {
        border: 1px solid gray;
        margin: 5px;
        padding: 5px;
      }
      .active {
        background: orange;
        color: white;
      }
      button,
      select {
        margin: 4px;
      }
    </style>
  </head>
  <body>
    <h2>Meal Explorer</h2>

    <select id="category">
      <option value="">All Categories</option>
    </select>
    <select id="area">
      <option value="">All Areas</option>
    </select>
    <select id="sort">
      <option value="">No Sort</option>
      <option value="asc">Name A→Z</option>
      <option value="desc">Name Z→A</option>
    </select>

    <div id="meals"></div>
    <div id="pages"></div>

    <script>
      let allMeals = [];
      let showMeals = [];
      let page = 1;
      let perPage = 5;

      async function getMeals() {
        let letters = "abcdefghijklmnopqrstuvwxyz".split("");
        for (let l of letters) {
          let res = await fetch(
            "https://www.themealdb.com/api/json/v1/1/search.php?f=" + l
          );
          let data = await res.json();
          if (data.meals) allMeals = allMeals.concat(data.meals);
        }
        showMeals = [...allMeals];
        fillSelects();
        display();
      }

      function fillSelects() {
        let catSel = document.getElementById("category");
        let areaSel = document.getElementById("area");
        let cats = [...new Set(allMeals.map((m) => m.strCategory))];
        let areas = [...new Set(allMeals.map((m) => m.strArea))];
        cats.forEach((c) => (catSel.innerHTML += `<option>${c}</option>`));
        areas.forEach((a) => (areaSel.innerHTML += `<option>${a}</option>`));
      }

      function display() {
        let mealsDiv = document.getElementById("meals");
        mealsDiv.innerHTML = "";
        let start = (page - 1) * perPage;
        let current = showMeals.slice(start, start + perPage);
        current.forEach((m) => {
          mealsDiv.innerHTML += `<div class="meal"><b>${m.strMeal}</b><br>${m.strCategory} | ${m.strArea}</div>`;
        });
        makePages();
      }

      function makePages() {
        let pagesDiv = document.getElementById("pages");
        pagesDiv.innerHTML = "";
        let total = Math.ceil(showMeals.length / perPage);
        if (total <= 1) return;
        pagesDiv.appendChild(pageBtn("First", () => go(1)));
        let max = 5;
        let start = 1;
        if (total > 10) {
          if (page <= max) start = 1;
          else if (page >= total - (max - 2)) start = total - (max - 1);
          else start = page - 2;
        }
        let end = Math.min(start + max - 1, total);
        for (let i = start; i <= end; i++) {
          let b = pageBtn(i, () => go(i));
          if (i === page) b.classList.add("active");
          pagesDiv.appendChild(b);
        }
        pagesDiv.appendChild(pageBtn("Last", () => go(total)));
      }

      function pageBtn(text, fn) {
        let b = document.createElement("button");
        b.textContent = text;
        b.onclick = fn;
        return b;
      }

      function go(p) {
        page = p;
        display();
      }

      function update() {
        let c = document.getElementById("category").value;
        let a = document.getElementById("area").value;
        showMeals = allMeals.filter(
          (m) =>
            (c === "" || m.strCategory === c) && (a === "" || m.strArea === a)
        );
        let s = document.getElementById("sort").value;
        if (s === "asc")
          showMeals.sort((x, y) => x.strMeal.localeCompare(y.strMeal));
        if (s === "desc")
          showMeals.sort((x, y) => y.strMeal.localeCompare(x.strMeal));
        page = 1;
        display();
      }

      document.getElementById("category").onchange = update;
      document.getElementById("area").onchange = update;
      document.getElementById("sort").onchange = update;

      getMeals();
    </script>
  </body>
</html>
